# tcc_measurement_monitoring_sample

tcc_measurement_monitoring_sample is a simple self-contained example of a monitoring application. The sample monitors measurements generated by the single measurement sample (tcc_single_measurement_sample). As the single measurement sample runs, the monitoring sample prints the latency of each workload iteration. The sample also prints a message when a measurement exceeds the deadline set in the environment. 

The sample is intended for all platforms.

**Note:** Samples are intended to demonstrate how to write code using certain features. They are not performance benchmarks. Example output shown here is for illustration only. Your output may vary.

## Source Files

 File | Description
 ---- | -----------
 [main.c](src/main.c)| Main file containing code sample

## Examples of Usage

| [Monitor Measurements Only](#monitor-measurements-only) | [Monitor Measurements and Deadline Violations](#monitor-measurements-and-deadline-violations) |

### Monitor Measurements Only 

#### Example Command

1. On the target system, open two terminal windows.


2. In the first terminal window, run the monitoring sample:

```
 TCC_MEASUREMENTS_BUFFERS=Approximation:10:2000 tcc_measurement_monitoring_sample 
```

3. In the second terminal window, start the single measurement sample:

```
TCC_MEASUREMENTS_BUFFERS=Approximation:10:2000 TCC_USE_SHARED_MEMORY=true tcc_single_measurement_sample -a 100 -i 10  
```

4. Go back to the first terminal. You should see that the monitoring sample is printing latency measurements.

#### Example Output
```
Approximation: 33698 CPU cycles
Approximation: 31340 CPU cycles
Approximation: 31455 CPU cycles
Approximation: 31693 CPU cycles
Approximation: 31643 CPU cycles
Approximation: 31696 CPU cycles
Approximation: 31317 CPU cycles
Approximation: 31288 CPU cycles
Approximation: 31635 CPU cycles
Approximation: 32152 CPU cycles
Count of read data:10
```

### Monitor Measurements and Deadline Violations

#### Example Command

1. In the first terminal window, run the monitoring sample:

```
TCC_MEASUREMENTS_BUFFERS=Approximation:10:2000 TCC_MEASUREMENTS_TIME_UNIT=ns tcc_measurement_monitoring_sample 
```

2. In the second terminal window, start the single measurement sample:

Run the sample with "-o" flag to increase the workload execution time for some of the measurements, thus leading to exceeding deadlines.

```
TCC_MEASUREMENTS_BUFFERS=Approximation:10:2000 TCC_USE_SHARED_MEMORY=true tcc_single_measurement_sample -a 20 -i 10 -o 
```

3. Go back to the first terminal. You should see that the monitoring sample is printing latency measurements and deadline violations, if any.

#### Example Output
```
Initializing monitoring for "Approximation", buffer size 10
Approximation: 302949666 CPU cycles
Latency exceeding deadline: 302949666 CPU cycles
Approximation: 1018 CPU cycles
Approximation: 775 CPU cycles
Approximation: 770 CPU cycles
Approximation: 774 CPU cycles
Approximation: 302847486 CPU cycles
Latency exceeding deadline: 302847486 CPU cycles
Approximation: 1124 CPU cycles
Approximation: 770 CPU cycles
Approximation: 768 CPU cycles
Approximation: 770 CPU cycles
Deadline: 2000 CPU cycles
Number of exceeding deadlines: 2 of 10
Count of read data:10
Finishing monitoring

```

If there are errors with shared memory, the sample prints the following output:
```
shmget: Invalid argument
shmat: Invalid argument
```

## Command-Line Options
```
Usage: [environment variables] tcc_measurement_monitoring_sample
Options:
    -h | --help            Show this help message and exit

Environment variables setup:
    TCC_MEASUREMENTS_BUFFERS
        Measurement instances inside the profiled application to use to collect the measurement history.
        Format: <measurement_name>:<buffer_size>[:<deadline>][,<measurement_name>:<buffer_size>[:<deadline>]]...
        measurement_name   measurement name used by Instrumentation and Tracing Technology
                           API (ITT API) in the profiled application for initializing the ITT
                           handlers to collect performance data
        buffer_size        number of measurements to store
        deadline           maximum tolerable latency for each iteration in time units set by
                           TCC_MEASUREMENTS_TIME_UNIT environment variable. It should be the same
                           as the process that will record data
    TCC_MEASUREMENTS_TIME_UNIT
        Time unit that will be used to store the results.
        Format: clk|ns|us
        clk                for CPU clock cycles
        ns                 for nanoseconds
        us                 for microseconds
    TCC_MEASUREMENTS_DUMP_FILE
        File where measurements are logged after the program finishes.

```

## Legal Information

© Intel Corporation​. Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries. Other names and brands may be claimed as the property of others.

Copyright Intel Corporation
